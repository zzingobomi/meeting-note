{"version":3,"sources":["fbase.js","components/Header.js","components/AuthForm.js","routes/Auth.js","components/RoomInfo.js","routes/Lobby.js","components/volumemeter/audioworklet/useVolume.js","components/volumemeter/volumemeter/index.js","components/volumemeter/audioworklet/index.js","components/volumemeter/index.js","components/MediaInfo.js","routes/CreateRoom.js","components/Video.js","routes/MeetingRoom.js","routes/Prepare.js","routes/Wrapup.js","routes/NotFound.js","components/Router.js","components/App.js","i18n/locales/ko/index.js","i18n/index.js","store.js","index.js"],"names":["authService","initializeApp","apiKey","process","authDomain","projectId","storageBucket","messagingSenderId","appId","getAuth","dbService","getFirestore","Header","t","useTranslation","loginedUser","useSelector","store","useState","anchorEl","setAnchorEl","open","Boolean","handleClick","event","currentTarget","handleClose","className","Container","maxWidth","Menu","id","onClose","MenuListProps","MenuItem","onClick","signOut","photoURL","displayName","src","undefined","AuthForm","createMode","setCreateMode","error","setError","validationSchema","yup","email","required","password","min","formik","useFormik","initialValues","onSubmit","values","onEmailSubmit","a","createUserWithEmailAndPassword","signInWithEmailAndPassword","message","Box","component","noValidate","autoComplete","handleSubmit","TextField","name","type","label","variant","value","onChange","handleChange","touched","errors","helperText","Button","prev","Auth","onAnonymousClick","signInAnonymously","onSocialClick","provider","GoogleAuthProvider","FacebookAuthProvider","console","log","signInWithPopup","startIcon","style","fill","RoomInfo","roomObj","history","isOwner","useHistory","Card","sessionInfo","entranceRoom","window","sessionStorage","setItem","JSON","stringify","push","CardContent","DateTime","fromMillis","createdAt","toFormat","creatorNickName","creatorPhotoUrl","Lobby","rooms","setRooms","useEffect","getRooms","q","query","collection","orderBy","onSnapshot","snapshot","roomArr","docs","map","doc","data","Grid","container","spacing","justifyContent","alignItems","item","xs","sm","md","lg","filter","room","creatorId","uid","useVolume","stream","React","volume","setVolume","ref","useRef","onmessage","useCallback","current","audioContext","Math","round","disconnectAudioContext","node","disconnect","errMsg","source","connectAudioContext","mediaStream","AudioContext","audioWorklet","addModule","createMediaStreamSource","AudioWorkletNode","port","connect","destination","VolumeMeter","max","dividerList","useMemo","list","width","i","left","transform","ceil","defaultProps","memo","p","n","AudioWorkletNodeVolumeMeter","MediaInfo","onCameraChange","videoPreview","cameras","setCameras","selectCamera","setSelectCamera","setStream","getMedia","cleanup","getTracks","forEach","track","stop","deviceId","initialConstrains","audio","video","facingMode","cameraConstrains","exact","navigator","mediaDevices","getUserMedia","myStream","srcObject","getCameras","enumerateDevices","devices","videoCameras","device","kind","cameraArr","videoCamera","text","tracks","getSettings","length","handleCameraChange","target","autoPlay","playsInline","FormControl","InputLabel","Select","labelId","CreateRoom","setDeviceId","roomname","nickname","onCreateRoomSubmit","newRoom","now","toMillis","addDoc","docRef","nickName","Video","muted","isMuted","setIsMuted","MeetingRoom","localStream","newSocket","pcs","parse","getItem","response","setResponse","localVideo","socket","setSocket","users","setUsers","initWebRTC","cleanupSocket","cleanupStream","handleSocket","close","socketIOClient","on","emit","allUsers","len","createPeerConnection","pc","createOffer","offerToReceiveAudio","offerToReceiveVideo","then","sdp","setLocalDescription","RTCSessionDescription","offerSendID","offerSendNickName","offerReceiveID","catch","setRemoteDescription","createAnswer","answerSendID","answerReceiveID","candidateSendID","addIceCandidate","RTCIceCandidate","candidate","oldUsers","user","socketID","RTCPeerConnection","iceServers","urls","onicecandidate","e","candidateReceiveID","oniceconnectionstatechange","ontrack","streams","addTrack","deleteMyRoom","deleteDoc","index","getAudioTracks","enabled","confirm","Prepare","roomId","setRoomId","setRoom","onEntranceRoomSubmit","getRoom","getDoc","docSnap","exists","Number","Wrapup","startTime","setStartTime","durationTime","setDurationTime","messages","downloadElem","diff","replace","getMessages","messagesQuery","getDocs","downloadMessages","dataStr","encodeURIComponent","setAttribute","click","onMessagesClick","isAnonymous","display","NotFound","FragmentSupportingSwitch","flattenedChildren","flatten","children","createElement","apply","Switch","concat","Children","child","isValidElement","Fragment","props","AppRouter","basename","path","to","App","init","setInit","dispatch","useDispatch","onAuthStateChanged","page","i18n","use","initReactI18next","resources","ko","lng","fallbackLng","ns","interpolation","escapeValue","createStore","state","action","__REDUX_DEVTOOLS_EXTENSION__","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.a56a1ca1.chunk.js","sourcesContent":["import { initializeApp } from \"firebase/app\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getFirestore } from \"firebase/firestore\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.REACT_APP_API_KEY,\r\n  authDomain: process.env.REACT_APP_AUTH_DOMAIN,\r\n  projectId: process.env.REACT_APP_PROJECTID,\r\n  storageBucket: process.env.REACT_APP_STORAGE_BUCKET,\r\n  messagingSenderId: process.env.REACT_APP_MESSAGIN_ID,\r\n  appId: process.env.REACT_APP_APP_ID,\r\n};\r\n\r\nconst app = initializeApp(firebaseConfig);\r\nexport const authService = getAuth();\r\nexport const dbService = getFirestore();\r\n","import { Container, Menu, MenuItem } from \"@mui/material\";\r\nimport React, { useState } from \"react\";\r\nimport { authService } from \"fbase\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useSelector } from \"react-redux\";\r\nimport AccountCircleIcon from \"@mui/icons-material/AccountCircle\";\r\nimport \"./Header.scss\";\r\n\r\nconst Header = () => {\r\n  const { t } = useTranslation([\"page\"]);\r\n  const loginedUser = useSelector((store) => store.loginedUser);\r\n\r\n  const [anchorEl, setAnchorEl] = useState(null);\r\n  const open = Boolean(anchorEl);\r\n\r\n  const handleClick = (event) => {\r\n    setAnchorEl(event.currentTarget);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setAnchorEl(null);\r\n  };\r\n\r\n  const onLogOutClick = () => {\r\n    handleClose();\r\n    authService.signOut();\r\n  };\r\n\r\n  return (\r\n    <header className=\"header\">\r\n      <Container maxWidth=\"lg\">\r\n        <div className=\"header-container\">\r\n          <span className=\"logo\">Meeting Note</span>\r\n          <Menu\r\n            id=\"basic-menu\"\r\n            anchorEl={anchorEl}\r\n            open={open}\r\n            onClose={handleClose}\r\n            MenuListProps={{\r\n              \"aria-labelledby\": \"basic-button\",\r\n            }}\r\n          >\r\n            <MenuItem onClick={onLogOutClick}>\r\n              {t(\"page:common:logout\")}\r\n            </MenuItem>\r\n          </Menu>\r\n\r\n          {loginedUser ? (\r\n            <>\r\n              {loginedUser.photoURL ? (\r\n                <div className=\"user-info\">\r\n                  <span>{loginedUser.displayName}</span>\r\n                  <img\r\n                    src={loginedUser.photoURL}\r\n                    aria-controls=\"basic-menu\"\r\n                    aria-haspopup=\"true\"\r\n                    aria-expanded={open ? \"true\" : undefined}\r\n                    onClick={handleClick}\r\n                  />\r\n                </div>\r\n              ) : (\r\n                <AccountCircleIcon\r\n                  className=\"anony\"\r\n                  aria-controls=\"basic-menu\"\r\n                  aria-haspopup=\"true\"\r\n                  aria-expanded={open ? \"true\" : undefined}\r\n                  onClick={handleClick}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <></>\r\n          )}\r\n        </div>\r\n      </Container>\r\n    </header>\r\n  );\r\n};\r\n\r\nexport default Header;\r\n","import React, { useState } from \"react\";\r\nimport {\r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n} from \"firebase/auth\";\r\nimport { authService } from \"fbase\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport Box from \"@mui/material/Box\";\r\nimport TextField from \"@mui/material/TextField\";\r\nimport { Button } from \"@mui/material\";\r\nimport { useFormik } from \"formik\";\r\nimport * as yup from \"yup\";\r\nimport \"./AuthForm.scss\";\r\n\r\nconst AuthForm = () => {\r\n  const { t } = useTranslation([\"page\"]);\r\n  const [createMode, setCreateMode] = useState(false);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const validationSchema = yup.object({\r\n    email: yup\r\n      .string(t(\"page:auth_form:validation:enter_email\"))\r\n      .email(t(\"page:auth_form:validation:valid_email\"))\r\n      .required(t(\"page:auth_form:validation:require_email\")),\r\n    password: yup\r\n      .string(t(\"page:auth_form:validation:enter_password\"))\r\n      .min(6, t(\"page:auth_form:validation:valid_password\"))\r\n      .required(t(\"page:auth_form:validation:require_password\")),\r\n  });\r\n\r\n  const formik = useFormik({\r\n    initialValues: {\r\n      email: \"\",\r\n      password: \"\",\r\n    },\r\n    validationSchema: validationSchema,\r\n    onSubmit: (values) => {\r\n      onEmailSubmit(values.email, values.password);\r\n    },\r\n  });\r\n\r\n  const onEmailSubmit = async (email, password) => {\r\n    let data;\r\n    try {\r\n      if (createMode) {\r\n        data = await createUserWithEmailAndPassword(\r\n          authService,\r\n          email,\r\n          password\r\n        );\r\n      } else {\r\n        data = await signInWithEmailAndPassword(authService, email, password);\r\n      }\r\n    } catch (error) {\r\n      setError(error.message);\r\n    }\r\n  };\r\n\r\n  const toggleCreateMode = () => setCreateMode((prev) => !prev);\r\n\r\n  return (\r\n    <>\r\n      <Box\r\n        className=\"login-box\"\r\n        component=\"form\"\r\n        noValidate\r\n        autoComplete=\"off\"\r\n        onSubmit={formik.handleSubmit}\r\n      >\r\n        <TextField\r\n          name=\"email\"\r\n          type=\"email\"\r\n          label={t(\"page:auth_form:label_email\")}\r\n          variant=\"standard\"\r\n          required\r\n          value={formik.values.email}\r\n          onChange={formik.handleChange}\r\n          error={formik.touched.email && Boolean(formik.errors.email)}\r\n          helperText={formik.touched.email && formik.errors.email}\r\n        />\r\n        <br />\r\n        <TextField\r\n          name=\"password\"\r\n          type=\"password\"\r\n          label={t(\"page:auth_form:label_password\")}\r\n          variant=\"standard\"\r\n          required\r\n          value={formik.values.password}\r\n          onChange={formik.handleChange}\r\n          error={formik.touched.password && Boolean(formik.errors.password)}\r\n          helperText={formik.touched.password && formik.errors.password}\r\n        />\r\n        <br />\r\n        <Button type=\"submit\" variant=\"contained\">\r\n          {createMode\r\n            ? t(\"page:auth_form:sign_up\")\r\n            : t(\"page:auth_form:sign_in\")}\r\n        </Button>\r\n      </Box>\r\n      <Button className=\"toggle-mode\" onClick={toggleCreateMode}>\r\n        {createMode ? t(\"page:auth_form:sign_in\") : t(\"page:auth_form:sign_up\")}\r\n      </Button>\r\n      <div className=\"error\">{error}</div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AuthForm;\r\n","import React, { useState } from \"react\";\r\nimport {\r\n  signInWithPopup,\r\n  GoogleAuthProvider,\r\n  FacebookAuthProvider,\r\n  signInAnonymously,\r\n} from \"firebase/auth\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { authService } from \"../fbase\";\r\nimport AuthForm from \"components/AuthForm\";\r\nimport { Button, Container } from \"@mui/material\";\r\nimport AccountCircleIcon from \"@mui/icons-material/AccountCircle\";\r\nimport GoogleIcon from \"@mui/icons-material/Google\";\r\nimport FacebookIcon from \"@mui/icons-material/Facebook\";\r\nimport \"./Auth.scss\";\r\n\r\nconst Auth = () => {\r\n  const { t } = useTranslation([\"page\"]);\r\n  const [error, setError] = useState(\"\");\r\n\r\n  const onAnonymousClick = async (event) => {\r\n    try {\r\n      await signInAnonymously(authService);\r\n    } catch (error) {\r\n      setError(error.message);\r\n    }\r\n  };\r\n\r\n  const onSocialClick = async (event, type) => {\r\n    let provider;\r\n    if (type === \"google\") {\r\n      provider = new GoogleAuthProvider();\r\n    } else if (type === \"facebook\") {\r\n      provider = new FacebookAuthProvider();\r\n    } else {\r\n      console.log(\"check social login type\");\r\n    }\r\n\r\n    try {\r\n      await signInWithPopup(authService, provider);\r\n    } catch (error) {\r\n      setError(error.message);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Container className=\"container login-container\" maxWidth=\"xs\">\r\n      <AuthForm></AuthForm>\r\n      <div className=\"social-container\">\r\n        <Button\r\n          className=\"btn-anony\"\r\n          variant=\"contained\"\r\n          onClick={onAnonymousClick}\r\n          startIcon={<AccountCircleIcon />}\r\n        >\r\n          {t(\"page:auth:login_with_anony\")}\r\n        </Button>\r\n        <br />\r\n        <Button\r\n          className=\"btn-google\"\r\n          variant=\"contained\"\r\n          onClick={(event) => onSocialClick(event, \"google\")}\r\n          startIcon={<GoogleIcon style={{ fill: \"#d50f25\" }} />}\r\n        >\r\n          {t(\"page:auth:login_with_google\")}\r\n        </Button>\r\n        <br />\r\n        <Button\r\n          className=\"btn-facebook\"\r\n          variant=\"contained\"\r\n          onClick={(event) => onSocialClick(event, \"facebook\")}\r\n          startIcon={<FacebookIcon />}\r\n        >\r\n          {t(\"page:auth:login_with_facebook\")}\r\n        </Button>\r\n        <div className=\"error\">{error}</div>\r\n      </div>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Auth;\r\n","import React, { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useHistory } from \"react-router\";\r\nimport { Card, CardContent } from \"@mui/material\";\r\nimport AccountCircleIcon from \"@mui/icons-material/AccountCircle\";\r\nimport { DateTime } from \"luxon\";\r\nimport \"./RoomInfo.scss\";\r\n\r\nconst RoomInfo = ({ roomObj, isOwner }) => {\r\n  const { t } = useTranslation([\"page\"]);\r\n  const history = useHistory();\r\n\r\n  const onEntranceClick = () => {\r\n    const sessionInfo = {\r\n      entranceRoom: { id: roomObj.id },\r\n    };\r\n    window.sessionStorage.setItem(\"sessionInfo\", JSON.stringify(sessionInfo));\r\n    history.push(\"/prepare\");\r\n  };\r\n\r\n  return (\r\n    <Card onClick={onEntranceClick}>\r\n      <CardContent>\r\n        <div className=\"room-creator-time\">\r\n          {DateTime.fromMillis(roomObj.createdAt).toFormat(\"MM/dd HH:mm\")}\r\n        </div>\r\n        <div className=\"room-name\">{roomObj.name}</div>\r\n        <div className=\"room-creator-info\">\r\n          <span>{roomObj.creatorNickName}</span>\r\n          {roomObj.creatorPhotoUrl ? (\r\n            <img src={roomObj.creatorPhotoUrl} />\r\n          ) : (\r\n            <AccountCircleIcon className=\"anony\" />\r\n          )}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default RoomInfo;\r\n","import {\r\n  collection,\r\n  doc,\r\n  onSnapshot,\r\n  orderBy,\r\n  query,\r\n} from \"@firebase/firestore\";\r\nimport { Container, Grid } from \"@mui/material\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport RoomInfo from \"../components/RoomInfo\";\r\nimport { dbService } from \"../fbase\";\r\nimport { Card, CardContent } from \"@mui/material\";\r\nimport AddIcon from \"@mui/icons-material/Add\";\r\nimport \"./Lobby.scss\";\r\n\r\nconst Lobby = () => {\r\n  const { t } = useTranslation([\"page\"]);\r\n  const history = useHistory();\r\n  const loginedUser = useSelector((store) => store.loginedUser);\r\n\r\n  const [rooms, setRooms] = useState([]);\r\n\r\n  useEffect(() => {\r\n    getRooms();\r\n  }, []);\r\n\r\n  const getRooms = () => {\r\n    const q = query(\r\n      collection(dbService, \"rooms\"),\r\n      orderBy(\"createdAt\", \"desc\")\r\n    );\r\n    onSnapshot(q, (snapshot) => {\r\n      // TODO: 이 snapshot 은 lobby 컴포넌트가 없어도 작동하는가?\r\n      // 방장이 나갔을때 다른 유저도 다같이 나가도록 해야 하는데..\r\n      const roomArr = snapshot.docs.map((doc) => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }));\r\n      setRooms(roomArr);\r\n    });\r\n  };\r\n\r\n  const onCreateRoomClick = () => {\r\n    history.push(\"/createroom\");\r\n  };\r\n\r\n  return (\r\n    <Container className=\"container lobby-container\" maxWidth=\"lg\">\r\n      <div className=\"room-container-title\">\r\n        <span>{t(\"page:lobby:my_room_title\")}</span>\r\n      </div>\r\n      <Grid\r\n        container\r\n        spacing={3}\r\n        justifyContent=\"flex-start\"\r\n        alignItems=\"stretch\"\r\n      >\r\n        <Grid item xs={12} sm={6} md={4} lg={3}>\r\n          <Card className=\"btn-create-card\" onClick={onCreateRoomClick}>\r\n            <CardContent className=\"btn-create-content\">\r\n              <AddIcon className=\"btn-create-icon\" />\r\n              <div className=\"btn-create-label\">\r\n                {t(\"page:lobby:create_room\")}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </Grid>\r\n        {rooms\r\n          .filter((room) => room.creatorId === loginedUser.uid)\r\n          .map((room) => (\r\n            <Grid key={room.id} item xs={12} sm={6} md={4} lg={3}>\r\n              <RoomInfo key={room.id} roomObj={room} isOwner={true} />\r\n            </Grid>\r\n          ))}\r\n      </Grid>\r\n      <div className=\"divider\"></div>\r\n      <div className=\"room-container-title\">\r\n        <span>{t(\"page:lobby:other_room_title\")}</span>\r\n      </div>\r\n      <Grid container spacing={3}>\r\n        {rooms\r\n          .filter((room) => room.creatorId !== loginedUser.uid)\r\n          .map((room) => (\r\n            <Grid key={room.id} item xs={12} sm={6} md={4} lg={3}>\r\n              <RoomInfo key={room.id} roomObj={room} isOwner={false} />\r\n            </Grid>\r\n          ))}\r\n      </Grid>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Lobby;\r\n","import React from \"react\";\n\nfunction useVolume(stream) {\n  const [volume, setVolume] = React.useState(0);\n\n  const ref = React.useRef({});\n\n  const onmessage = React.useCallback((event) => {\n    if (!ref.current.audioContext) {\n      return;\n    }\n    if (event.data.volume) {\n      setVolume(Math.round(event.data.volume * 200));\n    }\n  }, []);\n\n  const disconnectAudioContext = React.useCallback(() => {\n    if (ref.current.node) {\n      try {\n        ref.current.node.disconnect();\n      } catch (errMsg) {}\n    }\n    if (ref.current.source) {\n      try {\n        ref.current.source.disconnect();\n      } catch (errMsg) {}\n    }\n    ref.current.node = null;\n    ref.current.source = null;\n    ref.current.audioContext = null;\n    setVolume(0);\n  }, []);\n\n  const connectAudioContext = React.useCallback(\n    async (mediaStream) => {\n      if (ref.current.audioContext) {\n        disconnectAudioContext();\n      }\n      try {\n        ref.current.audioContext = new AudioContext();\n        await ref.current.audioContext.audioWorklet.addModule(\n          \"./worklet/vumeter.js\"\n        );\n        if (!ref.current.audioContext) {\n          return;\n        }\n        ref.current.source =\n          ref.current.audioContext.createMediaStreamSource(mediaStream);\n        ref.current.node = new AudioWorkletNode(\n          ref.current.audioContext,\n          \"vumeter\"\n        );\n        ref.current.node.port.onmessage = onmessage;\n        ref.current.source\n          .connect(ref.current.node)\n          .connect(ref.current.audioContext.destination);\n      } catch (errMsg) {\n        disconnectAudioContext();\n      }\n    },\n    [disconnectAudioContext, onmessage]\n  );\n\n  React.useEffect(() => {\n    setVolume(0);\n    if (!stream) {\n      return () => {};\n    }\n    connectAudioContext(stream);\n    return () => {\n      disconnectAudioContext(stream);\n    };\n  }, [stream, connectAudioContext, disconnectAudioContext]);\n\n  return volume;\n}\n\nexport default useVolume;\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport \"./index.css\";\n\nconst VolumeMeter = ({ volume, max = 10, style = {} }) => {\n  const dividerList = React.useMemo(() => {\n    const list = [];\n    const width = 100 / (max * 2);\n    for (let i = 0; i < max; i += 1) {\n      list.push(\n        <div\n          key={i}\n          className=\"volumeMeterDivider\"\n          style={{ left: `${(2 * i + 1) * width}%`, width: `${width}%` }}\n        />\n      );\n    }\n    return list;\n  }, [max]);\n\n  return (\n    <div className=\"volumeMeter\" style={style}>\n      <div className=\"volumeMeterBg\" />\n      <div\n        className=\"volumeMeterInner\"\n        style={{\n          transform: `scaleX(${Math.ceil((volume * max) / 100) / max})`,\n        }}\n      />\n      {dividerList}\n    </div>\n  );\n};\n\nVolumeMeter.propTypes = {\n  volume: PropTypes.number,\n  max: PropTypes.number,\n  style: PropTypes.object,\n};\n\nVolumeMeter.defaultProps = {\n  volume: null,\n  max: 0,\n  style: null,\n};\n\nexport default React.memo(\n  VolumeMeter,\n  (p, n) => p.volume === n.volume && p.max === n.max && p.style === n.style\n);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport useVolume from \"./useVolume\";\nimport VolumeMeter from \"../volumemeter\";\n\nconst AudioWorkletNodeVolumeMeter = ({ stream, max, style }) => {\n  const volume = useVolume(stream);\n  return <VolumeMeter volume={volume} max={max} style={style} />;\n};\n\nAudioWorkletNodeVolumeMeter.propTypes = {\n  stream: PropTypes.object,\n  max: PropTypes.number,\n  style: PropTypes.object,\n};\n\nAudioWorkletNodeVolumeMeter.defaultProps = {\n  stream: null,\n  max: 0,\n  style: null,\n};\n\nexport default React.memo(\n  AudioWorkletNodeVolumeMeter,\n  (p, n) => p.stream === n.stream && p.max === n.max && p.style === n.style\n);\n","import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport AudioWorkletNodeVolumeMeter from \"./audioworklet\";\nimport \"./index.css\";\n\nconst VolumeMeter = ({ stream, max = 20, style = {} }) => {\n  return (\n    <AudioWorkletNodeVolumeMeter stream={stream} max={max} style={style} />\n  );\n};\n\nVolumeMeter.propTypes = {\n  type: PropTypes.oneOf([\"AudioWorkletNode\"]),\n  stream: PropTypes.object,\n  max: PropTypes.number,\n  style: PropTypes.object,\n};\n\nVolumeMeter.defaultProps = {\n  type: \"AudioWorkletNode\",\n  stream: null,\n  max: 0,\n  style: null,\n};\n\nexport default React.memo(\n  VolumeMeter,\n  (p, n) =>\n    p.type === n.type &&\n    p.stream === n.stream &&\n    p.max === n.max &&\n    p.style === n.style\n);\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { InputLabel, MenuItem, Select } from \"@mui/material\";\r\nimport FormControl from \"@mui/material/FormControl\";\r\nimport VolumeMeter from \"components/volumemeter\";\r\nimport MicIcon from \"@mui/icons-material/Mic\";\r\nimport \"./MediaInfo.scss\";\r\n\r\nconst MediaInfo = ({ onCameraChange }) => {\r\n  const { t } = useTranslation([\"page\"]);\r\n\r\n  const videoPreview = useRef();\r\n\r\n  const [error, setError] = useState(\"\");\r\n  const [cameras, setCameras] = useState([]);\r\n  const [selectCamera, setSelectCamera] = useState(\"\");\r\n  const [stream, setStream] = useState(null);\r\n\r\n  useEffect(() => {\r\n    getMedia();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      cleanup();\r\n    };\r\n  }, [stream]);\r\n\r\n  const cleanup = () => {\r\n    if (stream) {\r\n      stream.getTracks().forEach((track) => {\r\n        track.stop();\r\n      });\r\n    }\r\n  };\r\n\r\n  const getMedia = async (deviceId) => {\r\n    const initialConstrains = {\r\n      audio: true,\r\n      video: { facingMode: \"user\" },\r\n    };\r\n    const cameraConstrains = {\r\n      audio: true,\r\n      video: { deviceId: { exact: deviceId } },\r\n    };\r\n\r\n    try {\r\n      let myStream = await navigator.mediaDevices.getUserMedia(\r\n        deviceId ? cameraConstrains : initialConstrains\r\n      );\r\n      videoPreview.current.srcObject = myStream;\r\n      setStream(myStream);\r\n\r\n      if (!deviceId) {\r\n        await getCameras(myStream);\r\n      }\r\n    } catch (error) {\r\n      setError(error.message);\r\n    }\r\n  };\r\n\r\n  const getCameras = async (myStream) => {\r\n    try {\r\n      const devices = await navigator.mediaDevices.enumerateDevices();\r\n      const videoCameras = devices.filter(\r\n        (device) => device.kind === \"videoinput\"\r\n      );\r\n      const cameraArr = videoCameras.map((videoCamera) => ({\r\n        value: videoCamera.deviceId,\r\n        text: videoCamera.label,\r\n      }));\r\n      setCameras(cameraArr);\r\n\r\n      let tracks = myStream.getTracks();\r\n      for (let i = 0; i < tracks.length; i++) {\r\n        let deviceId = tracks[i].getSettings().deviceId;\r\n        videoCameras.forEach((videoCamera) => {\r\n          if (deviceId === videoCamera.deviceId) {\r\n            setSelectCamera(deviceId);\r\n            onCameraChange(deviceId);\r\n          }\r\n        });\r\n      }\r\n    } catch (error) {\r\n      setError(error.message);\r\n    }\r\n  };\r\n\r\n  const handleCameraChange = async (event) => {\r\n    setSelectCamera(event.target.value);\r\n    onCameraChange(event.target.value);\r\n    await getMedia(event.target.value);\r\n  };\r\n\r\n  return (\r\n    <div className=\"media-box\">\r\n      <video\r\n        className=\"video-preview\"\r\n        ref={videoPreview}\r\n        autoPlay\r\n        playsInline\r\n      />\r\n      <div className=\"mic-wrapper\">\r\n        <MicIcon />\r\n        <VolumeMeter className=\"volume-meter\" stream={stream} max={40} />\r\n      </div>\r\n      <FormControl className=\"select-camera\" variant=\"standard\">\r\n        <InputLabel id=\"select-camera-label\">\r\n          {t(\"page:media_info:select_camera_label\")}\r\n        </InputLabel>\r\n        <Select\r\n          labelId=\"select-camera-label\"\r\n          value={selectCamera}\r\n          onChange={handleCameraChange}\r\n          label=\"Camera\"\r\n        >\r\n          {cameras.map((item) => {\r\n            return (\r\n              <MenuItem key={item.value} value={item.value}>\r\n                {item.text}\r\n              </MenuItem>\r\n            );\r\n          })}\r\n        </Select>\r\n      </FormControl>\r\n      <div className=\"error\">{error}</div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MediaInfo;\r\n","import React, { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { addDoc, collection } from \"@firebase/firestore\";\r\nimport { dbService } from \"../fbase\";\r\nimport { useHistory } from \"react-router\";\r\nimport Box from \"@mui/material/Box\";\r\nimport TextField from \"@mui/material/TextField\";\r\nimport { Button, Container } from \"@mui/material\";\r\nimport { useFormik } from \"formik\";\r\nimport * as yup from \"yup\";\r\nimport MediaInfo from \"components/MediaInfo\";\r\nimport { DateTime } from \"luxon\";\r\nimport \"./CreateRoom.scss\";\r\n\r\nconst CreateRoom = () => {\r\n  const { t } = useTranslation([\"page\"]);\r\n  const history = useHistory();\r\n  const { uid, displayName, photoURL } = useSelector(\r\n    (store) => store.loginedUser\r\n  );\r\n\r\n  const [error, setError] = useState(\"\");\r\n  const [deviceId, setDeviceId] = useState(\"\");\r\n\r\n  const validationSchema = yup.object({\r\n    roomname: yup\r\n      .string(t(\"page:room_submit:validation:enter_roomname\"))\r\n      .max(20, t(\"page:room_submit:validation:valid_roomname\"))\r\n      .required(t(\"page:room_submit:validation:require_roomname\")),\r\n    nickname: yup\r\n      .string(t(\"page:room_submit:validation:enter_nickname\"))\r\n      .max(20, t(\"page:room_submit:validation:valid_nickname\"))\r\n      .required(t(\"page:room_submit:validation:require_nickname\")),\r\n  });\r\n\r\n  const formik = useFormik({\r\n    initialValues: {\r\n      roomname: \"\",\r\n      nickname: displayName,\r\n    },\r\n    validationSchema: validationSchema,\r\n    onSubmit: (values) => {\r\n      onCreateRoomSubmit(values.roomname, values.nickname);\r\n    },\r\n  });\r\n\r\n  const onCreateRoomSubmit = async (roomname, nickname) => {\r\n    const newRoom = {\r\n      name: roomname,\r\n      creatorId: uid,\r\n      creatorNickName: nickname,\r\n      creatorPhotoUrl: photoURL,\r\n      createdAt: DateTime.now().toMillis(),\r\n    };\r\n\r\n    try {\r\n      const docRef = await addDoc(collection(dbService, \"rooms\"), newRoom);\r\n      const sessionInfo = {\r\n        deviceId: deviceId,\r\n        nickName: nickname,\r\n        entranceRoom: { id: docRef.id, ...newRoom },\r\n      };\r\n      window.sessionStorage.setItem(\"sessionInfo\", JSON.stringify(sessionInfo));\r\n      history.push(\"/meetingroom\");\r\n    } catch (error) {\r\n      setError(error);\r\n    }\r\n  };\r\n\r\n  const onCameraChange = (deviceId) => {\r\n    setDeviceId(deviceId);\r\n  };\r\n\r\n  return (\r\n    <Container className=\"container create-room-container\" maxWidth=\"xs\">\r\n      <MediaInfo onCameraChange={onCameraChange}></MediaInfo>\r\n      <Box\r\n        className=\"create-room-box\"\r\n        component=\"form\"\r\n        noValidate\r\n        autoComplete=\"off\"\r\n        onSubmit={formik.handleSubmit}\r\n      >\r\n        <TextField\r\n          name=\"roomname\"\r\n          label={t(\"page:create_room:roomname_label\")}\r\n          variant=\"standard\"\r\n          required\r\n          value={formik.values.roomname}\r\n          onChange={formik.handleChange}\r\n          error={formik.touched.roomname && Boolean(formik.errors.roomname)}\r\n          helperText={formik.touched.roomname && formik.errors.roomname}\r\n        />\r\n        <br />\r\n        <TextField\r\n          name=\"nickname\"\r\n          label={t(\"page:create_room:nickname_label\")}\r\n          variant=\"standard\"\r\n          required\r\n          value={formik.values.nickname}\r\n          onChange={formik.handleChange}\r\n          error={formik.touched.nickname && Boolean(formik.errors.nickname)}\r\n          helperText={formik.touched.nickname && formik.errors.nickname}\r\n        />\r\n        <br />\r\n        <Button type=\"submit\" variant=\"contained\">\r\n          {t(\"page:create_room:create_room_label\")}\r\n        </Button>\r\n      </Box>\r\n      <div className=\"error\">{error}</div>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default CreateRoom;\r\n","import React, { useEffect, useRef, useState } from \"react\";\r\n\r\nconst Video = ({ nickName, stream, muted }) => {\r\n  const ref = useRef(null);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (ref.current) ref.current.srcObject = stream;\r\n    if (muted) setIsMuted(muted);\r\n  }, [stream, muted]);\r\n\r\n  return (\r\n    <>\r\n      <video ref={ref} muted={isMuted} autoPlay />\r\n      <span>{nickName}</span>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Video;\r\n","import {\r\n  addDoc,\r\n  collection,\r\n  deleteDoc,\r\n  doc,\r\n  onSnapshot,\r\n  orderBy,\r\n  query,\r\n} from \"@firebase/firestore\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useHistory } from \"react-router\";\r\nimport { dbService } from \"../fbase\";\r\nimport socketIOClient from \"socket.io-client\";\r\nimport MessageInfo from \"components/MessageInfo\";\r\nimport { Container } from \"@mui/material\";\r\nimport \"./MeetingRoom.scss\";\r\nimport Video from \"components/Video\";\r\n\r\n//const ENDPOINT = \"http://127.0.0.1:4000\";\r\n//const ENDPOINT = \"http://192.168.0.2:4000\";\r\nconst ENDPOINT = \"https://node.zzingobomi.synology.me\";\r\n\r\nconst MeetingRoom = () => {\r\n  const loginedUser = useSelector((store) => store.loginedUser);\r\n  const sessionInfo = JSON.parse(window.sessionStorage.getItem(\"sessionInfo\"));\r\n\r\n  const history = useHistory();\r\n\r\n  const [error, setError] = useState(\"\");\r\n  const [deviceId, setDeviceId] = useState(sessionInfo.deviceId);\r\n  const [nickName, setNickName] = useState(sessionInfo.nickName);\r\n  const [entranceRoom, setEntranceRoom] = useState(sessionInfo.entranceRoom);\r\n  const [messages, setMessages] = useState([]);\r\n  const [message, setMessage] = useState(\"\");\r\n\r\n  const [response, setResponse] = useState(\"\");\r\n\r\n  const localVideo = useRef();\r\n\r\n  const [stream, setStream] = useState(null); // localStream\r\n\r\n  const [socket, setSocket] = useState();\r\n  const [users, setUsers] = useState([]);\r\n\r\n  let localStream;\r\n  let newSocket;\r\n  let pcs;\r\n\r\n  useEffect(() => {\r\n    initWebRTC();\r\n    // TODO: message 처리\r\n    //getMessages();\r\n\r\n    return () => {\r\n      cleanupSocket();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      cleanupStream();\r\n    };\r\n  }, [stream]);\r\n\r\n  const initWebRTC = async () => {\r\n    await getMedia(deviceId);\r\n    handleSocket();\r\n  };\r\n\r\n  const cleanupSocket = () => {\r\n    if (socket) {\r\n      socket.close();\r\n    }\r\n  };\r\n\r\n  const cleanupStream = () => {\r\n    if (stream) {\r\n      stream.getTracks().forEach((track) => {\r\n        track.stop();\r\n      });\r\n    }\r\n  };\r\n\r\n  const getMedia = async (deviceId) => {\r\n    const cameraConstrains = {\r\n      audio: true,\r\n      video: { deviceId: { exact: deviceId } },\r\n    };\r\n\r\n    try {\r\n      localStream = await navigator.mediaDevices.getUserMedia(cameraConstrains);\r\n      localVideo.current.srcObject = localStream;\r\n      setStream(localStream);\r\n    } catch (error) {\r\n      setError(error.message);\r\n    }\r\n  };\r\n\r\n  const handleSocket = () => {\r\n    console.log(\"handleSocket\");\r\n    newSocket = socketIOClient(ENDPOINT);\r\n    newSocket.on(\"sayhello\", (data) => {\r\n      setResponse(data);\r\n    });\r\n\r\n    newSocket.emit(\"join_room\", { room: entranceRoom.id, nickName: nickName });\r\n\r\n    newSocket.on(\"all_users\", (allUsers) => {\r\n      console.log(\"allUsers\");\r\n\r\n      let len = allUsers.length;\r\n\r\n      for (let i = 0; i < len; i++) {\r\n        createPeerConnection(\r\n          allUsers[i].id,\r\n          allUsers[i].email,\r\n          newSocket,\r\n          localStream\r\n        );\r\n        let pc = pcs[allUsers[i].id];\r\n        if (pc) {\r\n          pc.createOffer({\r\n            offerToReceiveAudio: true,\r\n            offerToReceiveVideo: true,\r\n          })\r\n            .then((sdp) => {\r\n              console.log(\"create offer success\");\r\n              pc.setLocalDescription(new RTCSessionDescription(sdp));\r\n              newSocket.emit(\"offer\", {\r\n                sdp: sdp,\r\n                offerSendID: newSocket.id,\r\n                offerSendNickName: nickName,\r\n                offerReceiveID: allUsers[i].id,\r\n              });\r\n            })\r\n            .catch((error) => {\r\n              console.log(error);\r\n            });\r\n        }\r\n      }\r\n    });\r\n\r\n    newSocket.on(\"getOffer\", (data) => {\r\n      console.log(\"getOffer\");\r\n      createPeerConnection(\r\n        data.offerSendID,\r\n        data.offerSendNickName,\r\n        newSocket,\r\n        localStream\r\n      );\r\n      let pc = pcs[data.offerSendID];\r\n      if (pc) {\r\n        pc.setRemoteDescription(new RTCSessionDescription(data.sdp))\r\n          .then(() => {\r\n            console.log(\"answer set remote description success\");\r\n            pc.createAnswer({\r\n              offerToReceiveVideo: true,\r\n              offerToReceiveAudio: true,\r\n            })\r\n              .then((sdp) => {\r\n                console.log(\"create answer success\");\r\n                pc.setLocalDescription(new RTCSessionDescription(sdp));\r\n                newSocket.emit(\"answer\", {\r\n                  sdp: sdp,\r\n                  answerSendID: newSocket.id,\r\n                  answerReceiveID: data.offerSendID,\r\n                });\r\n              })\r\n              .catch((error) => {\r\n                console.log(error);\r\n              });\r\n          })\r\n          .catch((error) => {\r\n            console.log(error);\r\n          });\r\n      }\r\n    });\r\n\r\n    newSocket.on(\"getAnswer\", (data) => {\r\n      console.log(\"getAnswer\");\r\n      let pc = pcs[data.answerSendID];\r\n      if (pc) {\r\n        pc.setRemoteDescription(new RTCSessionDescription(data.sdp));\r\n      }\r\n    });\r\n\r\n    newSocket.on(\"getCandidate\", (data) => {\r\n      console.log(\"getCandidate\");\r\n      let pc = pcs[data.candidateSendID];\r\n      if (pc) {\r\n        pc.addIceCandidate(new RTCIceCandidate(data.candidate)).then(() => {\r\n          console.log(\"candidate add success\");\r\n        });\r\n      }\r\n    });\r\n\r\n    newSocket.on(\"user_exit\", (data) => {\r\n      console.log(\"user_exit\");\r\n      pcs[data.id].close();\r\n      delete pcs[data.id];\r\n      setUsers((oldUsers) => oldUsers.filter((user) => user.id !== data.id));\r\n    });\r\n\r\n    setSocket(newSocket);\r\n  };\r\n\r\n  const createPeerConnection = (socketID, nickName, newSocket, localStream) => {\r\n    let pc = new RTCPeerConnection({\r\n      iceServers: [\r\n        {\r\n          urls: [\r\n            \"stun:stun.l.google.com:19302\",\r\n            \"stun:stun1.l.google.com:19302\",\r\n            \"stun:stun2.l.google.com:19302\",\r\n            \"stun:stun3.l.google.com:19302\",\r\n            \"stun:stun4.l.google.com:19302\",\r\n          ],\r\n        },\r\n      ],\r\n    });\r\n\r\n    pcs = { ...pcs, [socketID]: pc };\r\n\r\n    pc.onicecandidate = (e) => {\r\n      if (e.candidate) {\r\n        console.log(\"onicecandidate\");\r\n        newSocket.emit(\"candidate\", {\r\n          candidate: e.candidate,\r\n          candidateSendID: newSocket.id,\r\n          candidateReceiveID: socketID,\r\n        });\r\n      }\r\n    };\r\n\r\n    pc.oniceconnectionstatechange = (e) => {\r\n      console.log(e);\r\n    };\r\n\r\n    pc.ontrack = (e) => {\r\n      console.log(\"ontrack success\");\r\n      setUsers((oldUsers) => oldUsers.filter((user) => user.id !== socketID));\r\n      setUsers((oldUsers) => [\r\n        ...oldUsers,\r\n        {\r\n          id: socketID,\r\n          nickName: nickName,\r\n          stream: e.streams[0],\r\n        },\r\n      ]);\r\n    };\r\n\r\n    if (localStream) {\r\n      console.log(\"localStream add\");\r\n      localStream.getTracks().forEach((track) => {\r\n        pc.addTrack(track, localStream);\r\n      });\r\n    } else {\r\n      console.log(\"no local stream\");\r\n    }\r\n\r\n    return pc;\r\n  };\r\n\r\n  const getMessages = () => {\r\n    const q = query(\r\n      collection(dbService, \"rooms\", entranceRoom.id, \"messages\"),\r\n      orderBy(\"createdAt\", \"asc\")\r\n    );\r\n    onSnapshot(q, (snapshot) => {\r\n      const messageArr = snapshot.docs.map((doc) => ({\r\n        id: doc.id,\r\n        ...doc.data(),\r\n      }));\r\n      setMessages(messageArr);\r\n    });\r\n  };\r\n\r\n  const onChange = (event) => {\r\n    const {\r\n      target: { value },\r\n    } = event;\r\n    setMessage(value);\r\n  };\r\n\r\n  const onSubmit = async (event) => {\r\n    event.preventDefault();\r\n    if (message === \"\") {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const newMessage = {\r\n        message: message,\r\n        createdAt: Date.now(),\r\n        creatorId: loginedUser.uid,\r\n      };\r\n      const docRef = await addDoc(\r\n        collection(dbService, \"rooms\", entranceRoom.id, \"messages\"),\r\n        newMessage\r\n      );\r\n      setMessage(\"\");\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  const deleteMyRoom = async () => {\r\n    if (entranceRoom.creatorId === loginedUser.uid) {\r\n      await deleteDoc(doc(dbService, `rooms/${entranceRoom.id}`));\r\n    }\r\n  };\r\n\r\n  const onDeleteClick = () => {\r\n    const ok = window.confirm(\"정말 회의실을 삭제하시겠습니까?\");\r\n    if (ok) {\r\n      deleteMyRoom();\r\n      history.push(\"/lobby\");\r\n    }\r\n  };\r\n\r\n  const onFinishClick = () => {\r\n    const ok = window.confirm(\"정말 회의를 종료하시겠습니까?\");\r\n    if (ok) {\r\n      history.push(\"/wrapup\");\r\n    }\r\n  };\r\n\r\n  const onMuteClick = () => {\r\n    stream\r\n      .getAudioTracks()\r\n      .forEach((track) => (track.enabled = !track.enabled));\r\n  };\r\n\r\n  return (\r\n    <Container className=\"container meeting-room-container\" maxWidth=\"lg\">\r\n      <p>socket response: {response}</p>\r\n\r\n      <video ref={localVideo} autoPlay playsInline />\r\n\r\n      {users.map((user, index) => {\r\n        return (\r\n          <Video key={index} nickName={user.nickName} stream={user.stream} />\r\n        );\r\n      })}\r\n\r\n      <br />\r\n      <br />\r\n      <button onClick={onMuteClick}>음소거</button>\r\n      <button onClick={onDeleteClick}>방삭제</button>\r\n      <button onClick={onFinishClick}>회의종료</button>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default MeetingRoom;\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { doc, getDoc } from \"@firebase/firestore\";\r\nimport MediaInfo from \"components/MediaInfo\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useHistory } from \"react-router\";\r\nimport { dbService } from \"../fbase\";\r\nimport Box from \"@mui/material/Box\";\r\nimport TextField from \"@mui/material/TextField\";\r\nimport { Button, Container } from \"@mui/material\";\r\nimport { useFormik } from \"formik\";\r\nimport * as yup from \"yup\";\r\nimport { DateTime } from \"luxon\";\r\nimport AccountCircleIcon from \"@mui/icons-material/AccountCircle\";\r\nimport \"./Prepare.scss\";\r\n\r\nconst Prepare = () => {\r\n  const { t } = useTranslation([\"page\"]);\r\n  const history = useHistory();\r\n  const { uid, displayName } = useSelector((store) => store.loginedUser);\r\n\r\n  const [roomId, setRoomId] = useState(\"\");\r\n  const [room, setRoom] = useState({});\r\n  const [error, setError] = useState(\"\");\r\n  const [deviceId, setDeviceId] = useState(\"\");\r\n\r\n  // TODO: 닉네임 없을 때 에러문구\r\n  const validationSchema = yup.object({\r\n    nickname: yup\r\n      .string(t(\"page:room_submit:validation:enter_nickname\"))\r\n      .max(20, t(\"page:room_submit:validation:valid_nickname\"))\r\n      .required(t(\"page:room_submit:validation:require_nickname\")),\r\n  });\r\n\r\n  const formik = useFormik({\r\n    initialValues: {\r\n      // TODO: dispalyName\r\n      nickname: \"test\",\r\n    },\r\n    validationSchema: validationSchema,\r\n    onSubmit: (values) => {\r\n      onEntranceRoomSubmit(values.nickname);\r\n    },\r\n  });\r\n\r\n  useEffect(() => {\r\n    getRoom();\r\n  }, []);\r\n\r\n  const getRoom = async () => {\r\n    const sessionInfo = JSON.parse(\r\n      window.sessionStorage.getItem(\"sessionInfo\")\r\n    );\r\n    setRoomId(sessionInfo.entranceRoom.id);\r\n    const docRef = doc(dbService, \"rooms\", sessionInfo.entranceRoom.id);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    if (docSnap.exists()) {\r\n      setRoom(docSnap.data());\r\n    } else {\r\n      console.log(\"No such document!\");\r\n    }\r\n  };\r\n\r\n  const onEntranceRoomSubmit = async (nickname) => {\r\n    const sessionInfo = {\r\n      deviceId: deviceId,\r\n      nickName: nickname,\r\n      entranceRoom: { id: roomId, ...room },\r\n    };\r\n    window.sessionStorage.setItem(\"sessionInfo\", JSON.stringify(sessionInfo));\r\n    history.push(\"/meetingroom\");\r\n  };\r\n\r\n  const onCameraChange = (deviceId) => {\r\n    setDeviceId(deviceId);\r\n  };\r\n\r\n  return (\r\n    <Container className=\"container prepare-room-container\" maxWidth=\"xs\">\r\n      <MediaInfo onCameraChange={onCameraChange}></MediaInfo>\r\n      <Box\r\n        className=\"prepare-room-box\"\r\n        component=\"form\"\r\n        noValidate\r\n        autoComplete=\"off\"\r\n        onSubmit={formik.handleSubmit}\r\n      >\r\n        <TextField\r\n          name=\"nickname\"\r\n          label={t(\"page:prepare_room:nickname_label\")}\r\n          variant=\"standard\"\r\n          required\r\n          value={formik.values.nickname}\r\n          onChange={formik.handleChange}\r\n          error={formik.touched.nickname && Boolean(formik.errors.nickname)}\r\n          helperText={formik.touched.nickname && formik.errors.nickname}\r\n        />\r\n        <br />\r\n        <div className=\"prepare-room-info\">\r\n          <div className=\"info-item prepare-room-name\">\r\n            <span>{room.name}</span>\r\n          </div>\r\n          <div className=\"info-item prepare-room-creator\">\r\n            <span>{room.creatorNickName}</span>\r\n            {room.creatorPhotoUrl ? (\r\n              <img className=\"creator-icon\" src={room.creatorPhotoUrl} />\r\n            ) : (\r\n              <AccountCircleIcon className=\"anony creator-icon\" />\r\n            )}\r\n          </div>\r\n          <div className=\"info-item prepare-room-time\">\r\n            {DateTime.fromMillis(Number(room.createdAt)).toFormat(\r\n              \"MM/dd HH:mm\"\r\n            )}\r\n          </div>\r\n        </div>\r\n        <br />\r\n        <Button type=\"submit\" variant=\"contained\">\r\n          {t(\"page:prepare_room:entrance_room_label\")}\r\n        </Button>\r\n      </Box>\r\n      <div className=\"error\">{error}</div>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Prepare;\r\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport {\r\n  collection,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  orderBy,\r\n  query,\r\n} from \"@firebase/firestore\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { dbService } from \"fbase\";\r\nimport { useHistory } from \"react-router\";\r\nimport { Button, Container } from \"@mui/material\";\r\nimport { DateTime } from \"luxon\";\r\nimport DirectionsRunIcon from \"@mui/icons-material/DirectionsRun\";\r\nimport \"./Wrapup.scss\";\r\n\r\n// TODO: start, end 를 parameter 로 받아서..? DeteTime.now 는 refresh 시 계속 증가함..\r\nconst Wrapup = () => {\r\n  const { t } = useTranslation([\"page\"]);\r\n  const history = useHistory();\r\n\r\n  const loginedUser = useSelector((store) => store.loginedUser);\r\n  const sessionInfo = JSON.parse(window.sessionStorage.getItem(\"sessionInfo\"));\r\n\r\n  const [error, setError] = useState(\"\");\r\n  const [startTime, setStartTime] = useState(\"\");\r\n  const [durationTime, setDurationTime] = useState(\"\");\r\n\r\n  let messages = [];\r\n  const downloadElem = useRef();\r\n\r\n  useEffect(() => {\r\n    getRoom();\r\n  }, []);\r\n\r\n  const getRoom = async () => {\r\n    const docRef = doc(dbService, \"rooms\", sessionInfo.entranceRoom.id);\r\n    const docSnap = await getDoc(docRef);\r\n\r\n    if (docSnap.exists()) {\r\n      const diff = DateTime.now().diff(\r\n        DateTime.fromMillis(Number(docSnap.data().createdAt))\r\n      );\r\n      let durationTime = diff\r\n        .toFormat(\"dd : hh : mm : ss\")\r\n        .replace(/^[0 : ]+(?=\\d[\\d : ]{3})/, \"\");\r\n      setDurationTime(durationTime);\r\n      setStartTime(\r\n        DateTime.fromMillis(Number(docSnap.data().createdAt)).toFormat(\r\n          \"MM/dd HH:mm\"\r\n        )\r\n      );\r\n    } else {\r\n      setError(\"No such rooms\");\r\n    }\r\n  };\r\n\r\n  const getMessages = async () => {\r\n    console.log(\"getMessages\");\r\n    const messagesQuery = query(\r\n      collection(dbService, \"rooms\", sessionInfo.entranceRoom.id, \"messages\"),\r\n      orderBy(\"createdAt\", \"asc\")\r\n    );\r\n    const messageSnapshot = await getDocs(messagesQuery);\r\n    messageSnapshot.forEach((doc) => {\r\n      messages.push(doc.data());\r\n    });\r\n  };\r\n\r\n  const downloadMessages = () => {\r\n    //console.log(messages);\r\n    // TODO: creatorId 대신 닉네임을..?\r\n    let dataStr =\r\n      \"data:text/json;charset=utf-8,\" +\r\n      encodeURIComponent(JSON.stringify(messages));\r\n    downloadElem.current.setAttribute(\"href\", dataStr);\r\n    downloadElem.current.setAttribute(\"download\", \"messages.json\");\r\n    downloadElem.current.click();\r\n  };\r\n\r\n  const onMessagesClick = async () => {\r\n    await getMessages();\r\n    downloadMessages();\r\n  };\r\n\r\n  const onGotoLobbyClick = () => {\r\n    history.push(\"/lobby\");\r\n  };\r\n\r\n  return (\r\n    <Container className=\"container wrapup-container\" maxWidth=\"xs\">\r\n      <div className=\"time-box\">\r\n        <DirectionsRunIcon className=\"run-icon\" />\r\n        <div className=\"timeline\">\r\n          <div className=\"line\"></div>\r\n        </div>\r\n        <div className=\"time-info\">\r\n          <span className=\"start-time\">{startTime}</span>\r\n          <span className=\"end-time\">\r\n            {DateTime.now().toFormat(\"MM/dd HH:mm\")}\r\n          </span>\r\n        </div>\r\n        <span className=\"duration\">{durationTime}</span>\r\n        {loginedUser.isAnonymous ? (\r\n          \"\"\r\n        ) : (\r\n          <>\r\n            <a ref={downloadElem} style={{ display: \"none\" }}></a>\r\n            <Button onClick={onMessagesClick}>\r\n              {t(\"page:wrapup:download_messages\")}\r\n            </Button>\r\n          </>\r\n        )}\r\n        <Button onClick={onGotoLobbyClick}>\r\n          {t(\"page:wrapup:goto_lobby\")}\r\n        </Button>\r\n      </div>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Wrapup;\r\n","import React from \"react\";\r\n\r\nconst NotFound = () => {\r\n  return <div>NotFound</div>;\r\n};\r\n\r\nexport default NotFound;\r\n","import React from \"react\";\r\nimport { BrowserRouter, Redirect, Route, Switch } from \"react-router-dom\";\r\nimport Auth from \"routes/Auth\";\r\nimport Lobby from \"routes/Lobby\";\r\nimport CreateRoom from \"routes/CreateRoom\";\r\nimport MeetingRoom from \"routes/MeetingRoom\";\r\nimport Prepare from \"routes/Prepare\";\r\nimport Wrapup from \"routes/Wrapup\";\r\nimport NotFound from \"routes/NotFound\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { Fragment } from \"react\";\r\n\r\nexport const FragmentSupportingSwitch = ({ children }) => {\r\n  const flattenedChildren = [];\r\n  flatten(flattenedChildren, children);\r\n  return React.createElement.apply(\r\n    React,\r\n    [Switch, null].concat(flattenedChildren)\r\n  );\r\n};\r\n\r\nfunction flatten(target, children) {\r\n  React.Children.forEach(children, (child) => {\r\n    if (React.isValidElement(child)) {\r\n      if (child.type === Fragment) {\r\n        flatten(target, child.props.children);\r\n      } else {\r\n        target.push(child);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nconst AppRouter = () => {\r\n  const loginedUser = useSelector((store) => store.loginedUser);\r\n  console.log(\"AppRouter\");\r\n\r\n  return (\r\n    <BrowserRouter basename={process.env.PUBLIC_URL}>\r\n      <FragmentSupportingSwitch>\r\n        {loginedUser ? (\r\n          <>\r\n            <Route exact path=\"/\">\r\n              <Redirect to=\"/lobby\" />\r\n            </Route>\r\n            <Route exact path=\"/lobby\">\r\n              <Lobby></Lobby>\r\n            </Route>\r\n            <Route exact path=\"/createroom\">\r\n              <CreateRoom></CreateRoom>\r\n            </Route>\r\n            <Route exact path=\"/prepare\">\r\n              <Prepare></Prepare>\r\n            </Route>\r\n            <Route exact path=\"/meetingroom\">\r\n              <MeetingRoom></MeetingRoom>\r\n            </Route>\r\n            <Route exact path=\"/wrapup\">\r\n              <Wrapup></Wrapup>\r\n            </Route>\r\n            <Route path=\"*\" component={NotFound} />\r\n          </>\r\n        ) : (\r\n          <>\r\n            <Route exact path=\"/\">\r\n              <Auth></Auth>\r\n            </Route>\r\n            <Route path=\"*\">\r\n              <Redirect to=\"/\" />\r\n            </Route>\r\n          </>\r\n        )}\r\n      </FragmentSupportingSwitch>\r\n    </BrowserRouter>\r\n  );\r\n};\r\n\r\nexport default AppRouter;\r\n","import React, { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { authService } from \"../fbase\";\nimport Header from \"./Header\";\nimport AppRouter from \"./Router\";\n\nfunction App() {\n  const [init, setInit] = useState(false);\n  const dispatch = useDispatch();\n\n  useEffect(() => {\n    authService.onAuthStateChanged((user) => {\n      console.log(\"onAuthStateChanged\");\n      if (user) {\n        dispatch({ type: \"AUTH_STATE_CHANGED\", user: user });\n      } else {\n        dispatch({ type: \"AUTH_STATE_CHANGED\", user: null });\n      }\n      setInit(true);\n    });\n  }, []);\n\n  return (\n    <>\n      {init ? (\n        <>\n          <Header></Header>\n          <AppRouter></AppRouter>\n        </>\n      ) : (\n        \"loading...\"\n      )}\n    </>\n  );\n}\n\nexport default App;\n","import page from \"./page.json\";\r\n\r\nexport default {\r\n  page,\r\n};\r\n","import i18n from \"i18next\";\r\nimport { initReactI18next } from \"react-i18next\";\r\nimport ko from \"./locales/ko\";\r\n\r\ni18n.use(initReactI18next).init({\r\n  resources: {\r\n    ko: ko,\r\n  },\r\n  lng: \"ko\",\r\n  fallbackLng: \"ko\",\r\n  ns: [\"page\"],\r\n  interpolation: {\r\n    escapeValue: false,\r\n  },\r\n});\r\n\r\nexport default i18n;\r\n","import { createStore } from \"redux\";\r\nexport default createStore((state, action) => {\r\n  if (state === undefined) {\r\n    return {\r\n      loginedUser: null,\r\n    };\r\n  }\r\n  if (action.type === \"AUTH_STATE_CHANGED\") {\r\n    return { ...state, loginedUser: action.user };\r\n  }\r\n  return state;\r\n}, window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__());\r\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"components/App\";\nimport { Provider } from \"react-redux\";\nimport \"./i18n\";\nimport \"./style.scss\";\nimport store from \"./store\";\n\nReactDOM.render(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}